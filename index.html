<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ®å–®å­—æ¸¬é©—å°éŠæˆ²</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --text-dark: #1a1a1a;
            --primary: #0056b3;
            --success: #1e7e34;
            --danger: #bd2130;
            --warning: #f39c12;
            --border: #333333;
            --edit-bg: #fff9c4;
            --batch-bg: #e3f2fd;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; color: var(--text-dark); }
        .container { width: 100%; max-width: 500px; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); margin: auto; position: relative; }
        
        .page { display: none; }
        .page.active { display: block; }

        h2 { border-bottom: 3px solid var(--primary); padding-bottom: 10px; margin-top: 0; color: var(--text-dark); text-align: center; }
        p, label { font-weight: 800; color: #000; display: block; margin-bottom: 8px; }

        button { 
            width: 100%; padding: 16px; margin-bottom: 12px; border: 2px solid var(--border); 
            border-radius: 12px; font-size: 18px; font-weight: 800; cursor: pointer;
            background: #fff; color: var(--text-dark);
        }
        
        .option-btn.correct { background: var(--success) !important; color: white !important; }
        .option-btn.wrong { background: var(--danger) !important; color: white !important; }

        input, textarea { 
            width: 100%; padding: 14px; margin-bottom: 15px; border: 3px solid var(--border); 
            border-radius: 8px; font-size: 18px; font-weight: bold; background: white; color: black;
        }

        #timer-display {
            position: absolute; top: 40px; right: 25px; font-size: 24px; font-weight: 900;
            color: var(--danger); background: #fff; padding: 5px 10px; border-radius: 8px;
            border: 2px solid var(--danger); display: none; pointer-events: none; z-index: 10;
        }

        .quiz-word-container {
            width: 100%; margin: 20px 0; min-height: 80px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center; background: #f8f9fa; border-radius: 10px;
        }
        .quiz-word { font-size: 42px; color: var(--primary); font-weight: 900; word-break: break-all; }
        .scaffold-text { font-size: 26px; color: var(--warning); letter-spacing: 4px; font-weight: bold; margin-top: 5px; }

        .progress-bar { width: 100%; height: 12px; background: #ddd; border-radius: 6px; margin-bottom: 20px; overflow: hidden; border: 1px solid #999; }
        #progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.3s; }

        .item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 2px solid #ccc; gap: 8px; }
        .word-clickable { flex: 1; cursor: pointer; padding: 8px; border-radius: 8px; background: #fafafa; border: 1px solid #eee; min-width: 0; }
        .word-text { font-weight: bold; font-size: 18px; display: block; overflow: hidden; text-overflow: ellipsis; }
        
        /* é¸å–æ¨¡å¼æ¨£å¼èª¿æ•´ */
        .batch-checkbox { width: 25px; height: 25px; margin-right: 10px; cursor: pointer; display: none; flex-shrink: 0; }
        .selecting { background: #fffde7; }
        .selecting .batch-checkbox { display: block; }
        .selecting .btn-del { display: none; } 
        .selecting .stat-group { display: flex; } 

        .stat-group { display: flex; gap: 4px; flex-shrink: 0; }
        .stat-box { width: 38px; height: 38px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 900; color: white; border: 1px solid rgba(0,0,0,0.1); }
        .stat-choice { background-color: var(--primary); }
        .stat-input { background-color: var(--success); }
        
        .legend { font-size: 12px; background: #eee; padding: 8px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-around; border: 1px solid #ddd; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-weight: bold; }

        .btn-del { width: 40px; height: 40px; padding: 0; font-size: 16px; margin-bottom: 0; background: var(--danger); color: white; border: none; flex-shrink: 0; border-radius: 8px; }
        
        #wrong-confirm-box { display: none; background: #fff5f5; border: 2px solid var(--danger); padding: 15px; border-radius: 12px; margin-bottom: 15px; text-align: center; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #ddd; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 18px; font-weight: bold; }
        .wrong-list-area { background: #fff; border: 2px solid var(--danger); padding: 10px; border-radius: 8px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 16px; white-space: pre-wrap; }
        
        /* æ–°å¢ï¼šèªªæ˜æ›¸å…§çš„å…§å®¹æ’ç‰ˆ */
        .help-content { line-height: 1.6; font-size: 16px; text-align: left; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div id="timer-display">0</div>

    <div id="p-main" class="page active">
        <h2 style="font-size: 28px;">ğŸ˜ˆ all in one</h2>
        <button style="background:var(--primary); color:white; border:none; padding: 20px;" onclick="go('p-mode')">é–‹å§‹éŠæˆ²</button>
        <button onclick="go('p-mgr')">âš™ï¸ é¡Œåº«ç®¡ç† / å‚™ä»½</button>
        <button style="background:var(--warning); color:white; border:none;" onclick="go('p-help')">ğŸ“– éŠæˆ²åŠŸèƒ½èªªæ˜</button>
    </div>

   <div id="p-help" class="page">
        <h2 style="font-size: 24px;">ğŸ“– æ·±åº¦ä½¿ç”¨æŒ‡å—èˆ‡è¨­è¨ˆé‚è¼¯</h2>
        <div class="help-content" style="text-align: left; line-height: 1.7; font-size: 15px; color: #333;">
            
            <p>æœ¬å·¥å…·ä¸åƒ…æ˜¯æ¸¬é©—æ©Ÿï¼Œæ›´æ˜¯åŸºæ–¼<b>èªçŸ¥å¿ƒç†å­¸</b>è¨­è¨ˆçš„è¨˜æ†¶å¼·åŒ–ç³»çµ±ã€‚ä»¥ä¸‹æ˜¯å„é …æ ¸å¿ƒåŠŸèƒ½çš„è©³ç´°è§£æï¼š</p>

            <section style="margin-bottom: 20px;">
                <h3 style="color: var(--primary); border-left: 4px solid var(--primary); padding-left: 8px;">1. çµæ§‹åŒ–é¡Œåº«ç®¡ç† (Structured Organization)</h3>
                <p><b>å…·é«”æ“ä½œï¼š</b>åœ¨ã€Œé¡Œåº«ç®¡ç†ã€ä¸­å»ºç«‹ä¸åŒåç¨±çš„è³‡æ–™å¤¾ï¼ˆå¦‚ï¼šTOEIC å–®å­—ã€èª²æœ¬ L1ï¼‰ã€‚</p>
                <p><b>è¨­è¨ˆåˆè¡·ï¼š</b>äººé¡å¤§è…¦å°æ–¼æœ‰è¦å¾‹ã€æœ‰åˆ†é¡çš„è³‡è¨Šå¸æ”¶æœ€å¿«ã€‚é€éåˆ†é¡ï¼Œæ‚¨å¯ä»¥ç¸®å°å–®æ¬¡å­¸ç¿’çš„ç¯„ç–‡ï¼Œå»ºç«‹å¤§è…¦çš„ã€Œç´¢å¼•æ¨™ç±¤ã€ï¼Œé¿å…è³‡è¨Šéè¼‰ç”¢ç”Ÿçš„æ··æ·†ã€‚</p>
            </section>

            <section style="margin-bottom: 20px;">
                <h3 style="color: var(--primary); border-left: 4px solid var(--primary); padding-left: 8px;">2. æ™ºæ…§åŒ–éŒ„å…¥ç³»çµ± (Smart Entry)</h3>
                <p><b>å…·é«”æ“ä½œï¼š</b>å–®ç­†æ–°å¢é©åˆé›¶æ˜Ÿè£œå……ï¼›ã€ŒğŸš€ æ‰¹æ¬¡åŒ¯å…¥ã€å‰‡æ”¯æ´ <code>è‹±æ–‡ ä¸­æ–‡</code> æ ¼å¼çš„æ–‡å­—ç›´æ¥è²¼ä¸Šã€‚</p>
                <p><b>è¨­è¨ˆåˆè¡·ï¼š</b>éŒ„å…¥è³‡æ–™ä¸æ‡‰æˆç‚ºå­¸ç¿’çš„é˜»ç¤™ã€‚æ‰¹æ¬¡åŠŸèƒ½æ˜¯ç‚ºäº†è®“æ‚¨å°‡å¤–éƒ¨æ•™æï¼ˆå¦‚ PDFã€ç¶²é å–®å­—è¡¨ï¼‰å¿«é€Ÿè½‰åŒ–ç‚ºæ•¸ä½ç·´ç¿’é¡Œï¼Œå°‡å¯¶è²´çš„ç²¾åŠ›é›†ä¸­åœ¨ã€Œè¨˜æ†¶ã€è€Œéã€Œæ‰“å­—ã€ã€‚</p>
            </section>

            <section style="margin-bottom: 20px;">
                <h3 style="color: var(--primary); border-left: 4px solid var(--primary); padding-left: 8px;">3. éšæ¢¯å¼æ¸¬é©—æ¨¡å¼ (Scaffolded Testing)</h3>
                <p><b>å…·é«”æ“ä½œï¼š</b>å…ˆé€²è¡Œã€Œè‹±ç¿»ä¸­é¸æ“‡ã€ç†Ÿæ‚‰å–®å­—å½¢è±¡ï¼Œå†é€²è¡Œã€Œä¸­ç¿»è‹±å¡«å……ã€æŒ‘æˆ°æ‹¼å¯«ã€‚</p>
                <p><b>è¨­è¨ˆåˆè¡·ï¼š</b>éµå¾ªã€Œç”±æ·ºå…¥æ·±ã€çš„å­¸ç¿’æ›²ç·šã€‚é¸æ“‡é¡Œç·´ç¿’çš„æ˜¯<b>ã€Œå†èªè¨˜æ†¶ã€</b>ï¼ˆRecognitionï¼‰ï¼Œè€Œå¡«å……é¡Œå‰‡æ˜¯é›£åº¦æœ€é«˜çš„<b>ã€Œå›æ†¶è¨˜æ†¶ã€</b>ï¼ˆRecallï¼‰ã€‚å…©è€…ä¸¦è¡Œèƒ½ç¢ºä¿å¾çœ‹åˆ°å–®å­—æœ‰å°è±¡ï¼Œé€²æ­¥åˆ°èƒ½å®Œæ•´é‹ç”¨ã€‚</p>
            </section>

            <section style="margin-bottom: 20px;">
                <h3 style="color: var(--primary); border-left: 4px solid var(--primary); padding-left: 8px;">4. ç­”å°ç‡æ’åºé‚è¼¯ (Data-Driven Priority)</h3>
                <p><b>å…·é«”æ“ä½œï¼š</b>ç·¨è¼¯åˆ—è¡¨æœƒå‹•æ…‹å°‡ç­”å°ç‡æœ€ä½çš„å–®å­—ç½®é ‚ï¼Œä¸¦ä»¥è—è‰²èˆ‡ç¶ è‰²æ–¹å¡Šæ¨™ç¤ºç†Ÿç·´åº¦ã€‚</p>
                <p><b>è¨­è¨ˆåˆè¡·ï¼š</b>è½å¯¦ã€Œç²¾æº–ç·´ç¿’ã€ã€‚å¤§å¤šæ•¸äººå‚¾å‘é‡è¤‡ç·´ç¿’å·²ç¶“æœƒçš„å–®å­—ï¼Œé€™æœƒé€ æˆæ•ˆç‡ä½ä¸‹ã€‚ç³»çµ±å¼·åˆ¶å°‡æ‚¨çš„ã€Œå¼±é»ã€æ¨è‡³çœ¼å‰ï¼Œè®“æ¯ä¸€åˆ†é˜çš„è¤‡ç¿’éƒ½ç™¼æ®æœ€å¤§åƒ¹å€¼ã€‚</p>
            </section>

            <section style="margin-bottom: 20px;">
                <h3 style="color: var(--primary); border-left: 4px solid var(--primary); padding-left: 8px;">5. è‡ªå®šç¾©é›£åº¦èˆ‡é·¹æ¶æç¤º (Adaptive Difficulty)</h3>
                <p><b>å…·é«”æ“ä½œï¼š</b>æ¸¬é©—å‰å¯è¨­å®šã€Œè¨ˆæ™‚ç§’æ•¸ã€å¢åŠ é›£åº¦ï¼Œæˆ–å‹¾é¸ã€Œé¦–å°¾æç¤ºã€é™ä½æŒ«æŠ˜æ„Ÿã€‚</p>
                <p><b>è¨­è¨ˆåˆè¡·ï¼š</b>è¨ˆæ™‚å™¨æ˜¯ç‚ºäº†è¨“ç·´<b>ã€Œè‡ªå‹•åŒ–åæ‡‰ã€</b>ï¼ˆä¸ç¶“æ€è€ƒå°±èƒ½åå°„å–®å­—æ„ï¼‰ï¼Œæ¨¡æ“¬çœŸå¯¦å°è©±å£“åŠ›ã€‚é¦–å°¾æç¤ºå‰‡æ˜¯å­¸ç¿’å¿ƒç†å­¸ä¸­çš„ã€Œé·¹æ¶åŠŸèƒ½ã€ï¼Œåœ¨æ‚¨å·®ä¸€é»å°±æƒ³èµ·ä¾†æ™‚çµ¦äºˆé—œéµåŠ©æ¨ã€‚</p>
            </section>

            <section style="margin-bottom: 20px;">
                <h3 style="color: var(--primary); border-left: 4px solid var(--primary); padding-left: 8px;">6. å³æ™‚å›é¥‹èˆ‡é–‰ç’°è¤‡ç¿’ (Feedback Loop)</h3>
                <p><b>å…·é«”æ“ä½œï¼š</b>ç­”éŒ¯æ™‚ç«‹å³å½ˆå‡ºç­”æ¡ˆï¼Œæ¸¬é©—çµæŸå¾Œæä¾›ã€Œä¸€éµè¤‡è£½éŒ¯é¡Œã€ã€‚</p>
                <p><b>è¨­è¨ˆåˆè¡·ï¼š</b>å¤§è…¦åœ¨çŠ¯éŒ¯çš„é‚£ä¸€åˆ»å­¸ç¿’åŠ›æœ€é«˜ã€‚å³æ™‚ç³¾æ­£èƒ½ä¸­æ–·éŒ¯èª¤çš„è¯çµï¼›è¤‡è£½éŒ¯é¡ŒåŠŸèƒ½å‰‡è®“æ‚¨å¯ä»¥å°‡é€™ä»½æ¸…å–®å†æ¬¡åŒ¯å…¥æ–°é¡Œåº«ï¼Œå½¢æˆã€Œç·´ç¿’â†’ç™¼ç¾éŒ¯èª¤â†’å°ˆé …è¤‡ç¿’ã€çš„å®Œç¾é–‰ç’°ã€‚</p>
            </section>

            <section style="margin-bottom: 20px;">
                <h3 style="color: var(--primary); border-left: 4px solid var(--primary); padding-left: 8px;">7. JSON æœ¬åœ°å‚™ä»½æ©Ÿåˆ¶ (Data Portability)</h3>
                <p><b>å…·é«”æ“ä½œï¼š</b>å®šæœŸä½¿ç”¨ã€ŒåŒ¯å‡ºå‚™ä»½ã€ä¸‹è¼‰æª”æ¡ˆï¼Œæˆ–åœ¨æ›æ‰‹æ©Ÿæ™‚ä½¿ç”¨ã€ŒåŒ¯å…¥ã€è®€å–èˆŠè³‡æ–™ã€‚</p>
                <p><b>è¨­è¨ˆåˆè¡·ï¼š</b>ç‚ºäº†éš±ç§ï¼Œæ‚¨çš„æ•¸æ“šåƒ…å„²å­˜åœ¨æ‚¨è‡ªå·±çš„æ‰‹æ©Ÿè£¡ã€‚ä½†ç¶²é ç·©å­˜å¯èƒ½éºå¤±ï¼Œå®šæœŸåŒ¯å‡º JSON ä¸åƒ…æ˜¯ç‚ºäº†å®‰å…¨ï¼Œæ›´æ˜¯è®“æ‚¨å¯ä»¥å°‡è‡ªå·±è¾›è‹¦ç´¯ç©çš„æ•¸ä½è³‡ç”¢æ°¸ä¹…ä¿å­˜ã€‚</p>
            </section>
 	    <section style="margin-bottom: 20px;">
                <h3 style="color: var(--primary); border-left: 4px solid var(--primary); padding-left: 8px;">8.é–‹ç™¼è€…çš„è©± </h3>
                <p></b>å¦‚æ‚¨æ‰€è¦‹ï¼Œé€™æ˜¯ä¸€å€‹ç”±æˆ‘èˆ‡ AI å”ä½œé–‹ç™¼çš„ç¶²é å°éŠæˆ²ã€‚åœ¨æ‰€æœ‰åŠŸèƒ½ä¸­ï¼Œæˆ‘æœ€æ¨è–¦**ã€Œæ™ºæ…§æ‰¹æ¬¡åŒ¯å…¥ã€**ï¼šåªè¦æ‚¨çš„æ–‡å­—æ ¼å¼ç¶­æŒã€Œæ¯è¡Œä¸€å€‹è‹±æ–‡èˆ‡å°æ‡‰ä¸­æ–‡ã€ï¼Œç³»çµ±å³å¯è‡ªå‹•è§£æä¸¦å»ºæª”ã€‚é€™æ„å‘³è‘—æ‚¨å¯ä»¥å°‡æ•´é å–®å­—äº¤ç”± AI å¿«é€Ÿæ•´ç†å¾Œç›´æ¥åŒ¯å…¥ï¼Œå¾¹åº•å‘Šåˆ¥æ‰‹å‹•é€å­—è¼¸å…¥çš„ä½æ•ˆã€‚
è»Ÿé«”ä»æŒçºŒé€²åŒ–ä¸­ï¼Œè‹¥æ‚¨åœ¨ä½¿ç”¨éç¨‹ä¸­é‡åˆ°ä»»ä½•ç•°å¸¸ï¼Œæˆ–æœ‰æ–°çš„åŠŸèƒ½ææ¡ˆèˆ‡å„ªåŒ–å»ºè­°ï¼Œèª æ‘¯æ­¡è¿é€éé›»å­éƒµä»¶èˆ‡æˆ‘è¯ç¹«ï¼šstarsword0000@gmail.com</p>
            </section>


        </div>
        <button onclick="go('p-main')" style="background:var(--primary); color:white; border:none; margin-top: 10px;">æˆ‘äº†è§£äº†ï¼Œè¿”å›ä¸»é¸å–®</button>
    </div>

    <div id="p-mode" class="page">
        <h2>è«‹é¸æ“‡éŠæˆ²æ¨¡å¼</h2>
        <button style="border-color: var(--primary); color: var(--primary);" onclick="setGameMode('choice')">ğŸ…°ï¸ è‹±ç¿»ä¸­é¸æ“‡</button>
        <button style="border-color: var(--success); color: var(--success);" onclick="setGameMode('input')">âœï¸ ä¸­ç¿»è‹±å¡«å……</button>
        <button onclick="go('p-main')" style="margin-top: 10px; font-size: 14px;">è¿”å›ä¸»ç•«é¢</button>
    </div>

    <div id="p-sel" class="page">
        <h2 id="sel-title-text">è¨­å®šæ¸¬é©—</h2>
        <div id="sel-list"></div>
        <div id="quiz-config" style="display:none; margin-top:20px; border-top: 1px solid #eee; padding-top: 15px;">
            <label>1. æ¸¬é©—é¡Œæ•¸ï¼š</label>
            <input type="number" id="quiz-num-input" min="1" inputmode="numeric">
            <label>2. æ¯é¡Œæ™‚é–“ (ç§’)ï¼š</label>
            <input type="number" id="quiz-time-input" min="0" inputmode="numeric" value="10">
            <div id="config-input-only" style="display:none;">
                <label style="display: flex; align-items: center; background: #f9f9f9; padding: 10px; border-radius: 8px;">
                    <input type="checkbox" id="hint-toggle" style="width: auto; margin-right: 10px; margin-bottom: 0;"> é–‹å•Ÿé¦–å°¾æç¤º
                </label>
            </div>
            <p id="pool-info" style="font-size:14px; color:#555;"></p>
            <button style="background:var(--success); color:white; border:none;" onclick="startQuiz()">ç¢ºèªé–‹å§‹ï¼</button>
        </div>
        <button onclick="go('p-mode')" style="margin-top:10px;">è¿”å›</button>
    </div>

    <div id="p-quiz" class="page">
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <div id="q-info" style="text-align:center; font-weight:800; font-size:18px; margin-bottom: 10px;"></div>
        <div class="quiz-word-container">
            <div class="quiz-word" id="q-word-display"></div>
            <div id="q-hint-display" class="scaffold-text" style="display:none;"></div>
        </div>
        <div id="ui-choice" style="display:none;">
            <div id="q-options-container"></div>
            <div id="choice-next-box" style="display:none; margin-top: 10px;">
                <button onclick="nextQ()" style="background:#000; color:#fff;">ç¢ºèªä¸¦ç¹¼çºŒ â”</button>
            </div>
        </div>
        <div id="ui-input" style="display:none;">
            <div id="wrong-confirm-box">
                <div id="wrong-msg"></div>
                <button onclick="nextQ(true)" style="background:var(--danger); color:white; border:none;">æˆ‘çŸ¥é“äº†ï¼Œä¸‹ä¸€é¡Œ</button>
            </div>
            <div id="input-zone">
                <input type="text" id="ans-in" autocomplete="off" spellcheck="false" placeholder="è¼¸å…¥ç­”æ¡ˆ">
                <button onclick="checkInputAns()" style="background:var(--primary); color:white; border:none;">é€å‡º</button>
            </div>
        </div>
        <button onclick="if(confirm('çµæŸæ¸¬é©—ï¼Ÿ')) go('p-main')" style="margin-top:30px; font-size:14px; opacity:0.6; border:none;">çµæŸéŠæˆ²</button>
    </div>

    <div id="p-result" class="page">
        <h2>ğŸ‰ æ¸¬é©—å®Œæˆ</h2>
        <div class="stat-card">
            <div class="stat-row"><span>ç¸½é¡Œæ•¸ï¼š</span><span id="res-total">0</span></div>
            <div class="stat-row"><span>ç­”å°æ•¸ï¼š</span><span id="res-correct" style="color:var(--success);">0</span></div>
            <div class="stat-row"><span>ç­”å°ç‡ï¼š</span><span id="res-rate">0%</span></div>
        </div>
        <div id="res-wrong-section" style="display:none;">
            <div id="res-wrong-list" class="wrong-list-area"></div>
            <button onclick="copyWrongList()" style="margin-top:10px;">ğŸ“‹ è¤‡è£½éŒ¯é¡Œ</button>
        </div>
        <button onclick="go('p-main')" style="background:var(--primary); color:white; border:none;">è¿”å›ä¸»é¸å–®</button>
    </div>

    <div id="p-mgr" class="page">
        <h2>ğŸ—‚ é¡Œåº«ç®¡ç†</h2>
        <input type="text" id="db-in" placeholder="è¼¸å…¥æ–°é¡Œåº«åç¨±">
        <button onclick="addDB()" style="background:var(--primary); color:white; border:none;">å»ºç«‹æ–°é¡Œåº«</button>
        <div id="db-list"></div>
        <div style="margin-top:20px; text-align:center;">
            <button onclick="exportJSON()" style="font-size:14px;">åŒ¯å‡ºå‚™ä»½ (.json)</button>
            <input type="file" id="import-file" onchange="importJSON(event)" style="font-size:12px; margin-top:10px;">
        </div>
        <button onclick="go('p-main')">è¿”å›</button>
    </div>

    <div id="p-edit" class="page">
        <h2 id="edit-title">ç·¨è¼¯ä¸­</h2>
        <div class="legend">
            <div class="legend-item"><div class="stat-box stat-choice" style="width:20px; height:20px;"></div> é¸æ“‡é¡Œç­”å°ç‡</div>
            <div class="legend-item"><div class="stat-box stat-input" style="width:20px; height:20px;"></div> å¡«å……é¡Œç­”å°ç‡</div>
        </div>
        
        <div id="single-edit-area">
            <input type="text" id="w-in" placeholder="è‹±æ–‡å–®å­—">
            <input type="text" id="m-in" placeholder="ä¸­æ–‡ç¿»è­¯">
            <input type="hidden" id="editing-idx" value="-1">
            <button id="save-btn" onclick="saveWord()" style="background:var(--primary); color:white; border:none;">åŠ å…¥å–®å­—</button>
            <div style="display: flex; gap: 5px;">
                <button onclick="openBatchUI('import')" style="font-size:13px; flex:1;">ğŸš€ æ‰¹æ¬¡åŒ¯å…¥</button>
                <button onclick="startSelectionMode()" style="font-size:13px; flex:1;">ğŸ“¤ æ‰¹æ¬¡åŒ¯å‡º</button>
            </div>
        </div>

        <div id="select-control-bar" style="display:none; background:#eee; padding:10px; border-radius:8px; margin-bottom:10px; display:flex; gap:10px;">
            <button onclick="toggleSelectAll(true)" style="padding:8px; font-size:14px; flex:1;">å…¨é¸</button>
            <button onclick="toggleSelectAll(false)" style="padding:8px; font-size:14px; flex:1;">å…¨ä¸é¸</button>
            <button onclick="finishSelection()" style="padding:8px; font-size:14px; flex:1; background:var(--success); color:white; border:none;">ç¢ºèªé¸å–</button>
            <button onclick="cancelSelection()" style="padding:8px; font-size:14px; flex:1; background:#666; color:white; border:none;">å–æ¶ˆ</button>
        </div>

        <div id="batch-edit-area" style="display:none; background:var(--batch-bg); padding:15px; border-radius:12px; margin-top:10px;">
            <h3 id="batch-title" style="margin-top:0;">æ‰¹æ¬¡è™•ç†</h3>
            <textarea id="batch-input" rows="8" placeholder="æ ¼å¼ï¼šè‹±æ–‡ ä¸­æ–‡ [é¸ç¸½,é¸å°] {å¡«ç¸½,å¡«å°}"></textarea>
            <div id="batch-footer-btns">
                <button id="batch-submit-btn" onclick="handleBatchFinish()" style="background:var(--primary); color:white; border:none;">å®Œæˆå„²å­˜</button>
                <button id="batch-copy-btn" onclick="copyBatchContent()" style="background:#444; color:white; border:none; display:none;">ğŸ“‹ ä¸€éµè¤‡è£½å…¨éƒ¨</button>
                <button onclick="toggleBatch(false)" style="background:none; border:none; margin-bottom: 0;">å–æ¶ˆ</button>
            </div>
        </div>

        <div id="word-list-container" style="max-height:400px; overflow-y:auto; margin-top:15px; border:1px solid #eee;"></div>
        <button id="edit-exit-btn" onclick="go('p-mgr')" style="margin-top:10px;">é›¢é–‹ç·¨è¼¯</button>
    </div>
</div>

<script>
    // --- 1. åˆå§‹è¾­åº«è‡ªå‹•æ¤å…¥é‚è¼¯ ---
    const STORAGE_KEY = 'pro_v_db_v3';
    let savedData = localStorage.getItem(STORAGE_KEY);
    let db = {};

    if (!savedData || savedData === '{}') {
        // é€™æ˜¯çµ¦æ–°ä½¿ç”¨è€…çš„ç¬¬ä¸€å€‹é©šå–œé¡Œåº«
        db = {
            "ç³»çµ±é è¨­é¡Œåº«(æ¸¬è©¦èˆ‡é«”é©—åŠŸèƒ½ç”¨ï¼Œç„¡éœ€ä½¿ç”¨å¯åˆªé™¤)": [
                { w: "Success", m: "æˆåŠŸ", stats: { choice: {t:0, c:0}, input: {t:0, c:0} } },
                { w: "Challenge", m: "æŒ‘æˆ°", stats: { choice: {t:0, c:0}, input: {t:0, c:0} } },
                { w: "Practice", m: "ç·´ç¿’", stats: { choice: {t:0, c:0}, input: {t:0, c:0} } },
                { w: "Memory", m: "è¨˜æ†¶", stats: { choice: {t:0, c:0}, input: {t:0, c:0} } },
                { w: "Growth", m: "æˆé•·", stats: { choice: {t:0, c:0}, input: {t:0, c:0} } }
            ]
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
    } else {
        db = JSON.parse(savedData);
    }
    // --- åˆå§‹é‚è¼¯çµæŸï¼Œæ¥çºŒåŸæœ¬è®Šæ•¸ ---

    let currentDB = "";
    let currentGameMode = ""; 
    let quizQueue = [];
    let currentIdx = 0;
    let quizTimer = null;
    let correctCount = 0;
    let wrongList = [];
    let isSelecting = false;
    function parseStringToItem(line) {
        const regex = /^\s*(\S+)\s+(.+?)(?:\s*\[(\d+),(\d+)\])?(?:\s*\{(\d+),(\d+)\})?\s*$/;
        let match = line.match(regex);
        if(match) {
            return {
                w: match[1].trim(),
                m: match[2].trim(),
                stats: {
                    choice: { t: parseInt(match[3]) || 0, c: parseInt(match[4]) || 0 },
                    input: { t: parseInt(match[5]) || 0, c: parseInt(match[6]) || 0 }
                }
            };
        }
        let p = line.trim().split(/\s+/);
        if(p.length >= 2) {
            return { w: p[0], m: p.slice(1).join(" "), stats: { choice: {t:0, c:0}, input: {t:0, c:0} } };
        }
        return null;
    }

    function getModeRate(item, mode) {
        if (!item.stats || !item.stats[mode] || item.stats[mode].t === 0) return "--";
        return Math.round((item.stats[mode].c / item.stats[mode].t) * 100) + "%";
    }

    function getCombinedRate(item) {
        if (!item.stats) return 0;
        let totalT = (item.stats.choice?.t || 0) + (item.stats.input?.t || 0);
        let totalC = (item.stats.choice?.c || 0) + (item.stats.input?.c || 0);
        return totalT === 0 ? 0 : (totalC / totalT);
    }

    function isDuplicate(w, m, dbName, excludeIdx = -1) {
        if(!db[dbName]) return false;
        const targetW = w.trim().toLowerCase();
        const targetM = m.trim().toLowerCase();
        return db[dbName].some((item, idx) => {
            if (idx === excludeIdx) return false;
            return item.w.trim().toLowerCase() === targetW && item.m.trim().toLowerCase() === targetM;
        });
    }

    function go(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        if(quizTimer) clearInterval(quizTimer);
        document.getElementById('timer-display').style.display = 'none';
        if(pageId === 'p-mgr') drawDBList();
        if(pageId === 'p-sel') drawSelList();
        if(pageId !== 'p-edit') cancelSelection();
    }

    function setGameMode(mode) {
        currentGameMode = mode;
        document.getElementById('sel-title-text').innerText = (mode === 'choice' ? 'è‹±ç¿»ä¸­ï¼šè¨­å®š' : 'ä¸­ç¿»è‹±ï¼šè¨­å®š');
        document.getElementById('config-input-only').style.display = (mode === 'input' ? 'block' : 'none');
        go('p-sel');
    }

    function saveDB() { localStorage.setItem('pro_v_db_v3', JSON.stringify(db)); }

    function addDB() {
        let name = document.getElementById('db-in').value.trim();
        if(!name || db[name]) return alert("åç¨±ç„¡æ•ˆæˆ–å·²å­˜åœ¨");
        db[name] = []; saveDB(); drawDBList();
        document.getElementById('db-in').value = "";
    }

    function drawDBList() {
        let html = '';
        for(let n in db) {
            html += `<div class="item">
                <span onclick="openEdit('${n}')" style="color:var(--primary); font-weight:bold; cursor:pointer; flex:1;">ğŸ“‚ ${n} (${db[n].length})</span>
                <button class="btn-del" style="background:#666;" onclick="renameDB('${n}')">å</button>
                <button class="btn-del" onclick="if(confirm('åˆªé™¤æ•´å€‹é¡Œåº«ï¼Ÿ')){delete db['${n}']; saveDB(); drawDBList();}">åˆª</button>
            </div>`;
        }
        document.getElementById('db-list').innerHTML = html;
    }

    function renameDB(old) {
        let n = prompt("é‡å‘½åé¡Œåº«ï¼š", old);
        if(n && n.trim() && !db[n]) { db[n] = db[old]; delete db[old]; saveDB(); drawDBList(); }
    }

    function openEdit(n) {
        currentDB = n;
        document.getElementById('edit-title').innerText = n;
        resetEdit(); drawWordList(); go('p-edit');
    }

    function resetEdit() {
        document.getElementById('w-in').value = ""; document.getElementById('m-in').value = "";
        document.getElementById('editing-idx').value = "-1";
        document.getElementById('save-btn').innerText = "åŠ å…¥å–®å­—";
        document.getElementById('save-btn').style.background = "var(--primary)";
        toggleBatch(false);
    }

    function saveWord() {
        let w = document.getElementById('w-in').value.trim();
        let m = document.getElementById('m-in').value.trim();
        let idx = parseInt(document.getElementById('editing-idx').value);
        if(!w || !m) return alert("è«‹å¡«å¯«å®Œæ•´");
        if(isDuplicate(w, m, currentDB, idx)) return alert("æ­¤å–®å­—çµ„åˆå·²å­˜åœ¨ï¼");
        if(idx === -1) {
            db[currentDB].push({ w, m, stats: { choice: {t:0, c:0}, input: {t:0, c:0} } });
        } else {
            let originalStats = db[currentDB][idx].stats || { choice: {t:0, c:0}, input: {t:0, c:0} };
            db[currentDB][idx] = { w, m, stats: originalStats };
        }
        saveDB(); drawWordList(); resetEdit();
    }

    function drawWordList() {
        let list = db[currentDB];
        list.sort((a, b) => getCombinedRate(a) - getCombinedRate(b));
        let html = '';
        list.forEach((item, i) => {
            html += `<div class="item ${isSelecting ? 'selecting' : ''}">
                <input type="checkbox" class="batch-checkbox" data-idx="${i}">
                <div class="word-clickable" onclick="${isSelecting ? `toggleItemCheck(${i})` : `triggerEditWord(${i})`}">
                    <span class="word-text">${item.w}</span>
                    <small style="color:#666">${item.m}</small>
                </div>
                <div class="stat-group">
                    <div class="stat-box stat-choice">${getModeRate(item, 'choice')}</div>
                    <div class="stat-box stat-input">${getModeRate(item, 'input')}</div>
                </div>
                <button class="btn-del" onclick="db['${currentDB}'].splice(${i},1); saveDB(); drawWordList();">X</button>
            </div>`;
        });
        document.getElementById('word-list-container').innerHTML = html || '<p style="padding:20px; text-align:center; color:#999;">æ²’æœ‰å–®å­—</p>';
    }

    function startSelectionMode() {
        if(!db[currentDB] || db[currentDB].length === 0) return alert("é¡Œåº«æ˜¯ç©ºçš„");
        isSelecting = true;
        document.getElementById('single-edit-area').style.display = 'none';
        document.getElementById('select-control-bar').style.display = 'flex';
        document.getElementById('edit-exit-btn').style.display = 'none';
        drawWordList();
    }

    function toggleItemCheck(i) {
        const cb = document.querySelector(`.batch-checkbox[data-idx="${i}"]`);
        if(cb) cb.checked = !cb.checked;
    }

    function toggleSelectAll(val) {
        document.querySelectorAll('.batch-checkbox').forEach(cb => cb.checked = val);
    }

    function cancelSelection() {
        isSelecting = false;
        document.getElementById('single-edit-area').style.display = 'block';
        document.getElementById('select-control-bar').style.display = 'none';
        document.getElementById('edit-exit-btn').style.display = 'block';
        drawWordList();
    }

    function finishSelection() {
        const selectedIdxs = Array.from(document.querySelectorAll('.batch-checkbox:checked')).map(cb => parseInt(cb.dataset.idx));
        if(selectedIdxs.length === 0) return alert("è«‹è‡³å°‘å‹¾é¸ä¸€å€‹å–®å­—");
        const selectedData = selectedIdxs.map(idx => db[currentDB][idx]);
        isSelecting = false;
        document.getElementById('select-control-bar').style.display = 'none';
        document.getElementById('edit-exit-btn').style.display = 'block';
        const input = document.getElementById('batch-input');
        const submit = document.getElementById('batch-submit-btn');
        const copyBtn = document.getElementById('batch-copy-btn');
        document.getElementById('batch-title').innerText = `ğŸ“¤ åŒ¯å‡ºé¸å–çš„å–®å­— (${selectedData.length} å€‹)`;
        input.value = selectedData.map(i => formatItemToString(i)).join('\n');
        input.readOnly = true; 
        submit.style.display = "none"; 
        copyBtn.style.display = "block";
        toggleBatch(true);
    }

    function toggleBatch(show) {
        document.getElementById('single-edit-area').style.display = show ? 'none' : 'block';
        document.getElementById('batch-edit-area').style.display = show ? 'block' : 'none';
        document.getElementById('word-list-container').style.display = show ? 'none' : 'block';
    }

    function openBatchUI(mode) {
        const input = document.getElementById('batch-input');
        const submit = document.getElementById('batch-submit-btn');
        const copyBtn = document.getElementById('batch-copy-btn');
        if(mode === 'import') {
            document.getElementById('batch-title').innerText = "ğŸš€ æ™ºæ…§æ‰¹æ¬¡åŒ¯å…¥";
            input.value = ""; input.readOnly = false; submit.style.display = "block"; copyBtn.style.display = "none";
            toggleBatch(true);
        }
    }

    function handleBatchFinish() {
        let raw = document.getElementById('batch-input').value.trim();
        if(!raw) { toggleBatch(false); return; }
        let lines = raw.split('\n');
        let added = 0, skipped = 0;
        lines.forEach(line => {
            let item = parseStringToItem(line);
            if(item && !isDuplicate(item.w, item.m, currentDB)) {
                db[currentDB].push(item);
                added++;
            } else { skipped++; }
        });
        saveDB(); drawWordList(); toggleBatch(false);
        alert(`åŒ¯å…¥å®Œæˆï¼\næˆåŠŸï¼š${added}\nå¿½ç•¥ï¼š${skipped}`);
    }

    function copyBatchContent() {
        navigator.clipboard.writeText(document.getElementById('batch-input').value).then(() => alert("å·²è¤‡è£½ï¼"));
    }

    function triggerEditWord(i) {
        let item = db[currentDB][i];
        document.getElementById('w-in').value = item.w;
        document.getElementById('m-in').value = item.m;
        document.getElementById('editing-idx').value = i;
        document.getElementById('save-btn').innerText = "æ›´æ–°å–®å­—";
        document.getElementById('save-btn').style.background = "var(--warning)";
    }

    function exportJSON() {
        const blob = new Blob([JSON.stringify(db, null, 2)], {type: "application/json"});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
        a.download = `å–®å­—åº«å‚™ä»½_${new Date().toLocaleDateString()}.json`; a.click();
    }

    function importJSON(e) {
        const reader = new FileReader();
        const file = e.target.files[0];
        if(!file) return;
        reader.onload = (ev) => {
            try {
                let data = JSON.parse(ev.target.result);
                let report = "";
                for(let key in data) {
                    if(!db[key]) {
                        db[key] = data[key];
                        report += `æ–°å¢é¡Œåº«ã€Œ${key}ã€\n`;
                    } else {
                        let added = 0, skipped = 0;
                        data[key].forEach(nw => {
                            if(!isDuplicate(nw.w, nw.m, key)) {
                                nw.stats = nw.stats || { choice: {t:0, c:0}, input: {t:0, c:0} };
                                db[key].push(nw);
                                added++;
                            } else { skipped++; }
                        });
                        report += `æ›´æ–°ã€Œ${key}ã€ï¼šæ–°å¢ ${added}ï¼Œé‡è¤‡ ${skipped}\n`;
                    }
                }
                saveDB(); drawDBList(); alert("åŒ¯å…¥æˆåŠŸï¼\n" + report);
            } catch(err) { alert("æª”æ¡ˆæ ¼å¼éŒ¯èª¤"); }
        };
        reader.readAsText(file); e.target.value = ""; 
    }

    function prepQuiz(n) {
        currentDB = n;
        document.querySelectorAll('#sel-list button').forEach(b => b.style.border = '2px solid #333');
        const target = document.getElementById('btn-sel-'+n);
        if(target) target.style.border = '5px solid black';
        document.getElementById('quiz-config').style.display = 'block';
        document.getElementById('quiz-num-input').value = db[n].length;
        document.getElementById('pool-info').innerText = "ä¸Šé™ï¼š" + db[n].length + " é¡Œ";
    }

    function drawSelList() {
        let html = '';
        for(let n in db) html += `<button id="btn-sel-${n}" onclick="prepQuiz('${n}')">${n} (${db[n].length})</button>`;
        document.getElementById('sel-list').innerHTML = html || 'è«‹å…ˆå»ºç«‹é¡Œåº«';
    }

    function startQuiz() {
        let pool = db[currentDB];
        if(!pool || pool.length < 1) return alert("å–®å­—ä¸å¤ ");
        let limit = parseInt(document.getElementById('quiz-num-input').value) || pool.length;
        quizQueue = [...pool].sort(() => 0.5 - Math.random()).slice(0, limit);
        currentIdx = 0; correctCount = 0; wrongList = [];
        document.getElementById('ui-choice').style.display = (currentGameMode === 'choice' ? 'block' : 'none');
        document.getElementById('ui-input').style.display = (currentGameMode === 'input' ? 'block' : 'none');
        go('p-quiz'); renderNextQ();
    }

    function renderNextQ() {
        if(quizTimer) clearInterval(quizTimer);
        let q = quizQueue[currentIdx];
        document.getElementById('q-info').innerText = `é¡Œç›®ï¼š ${currentIdx + 1} / ${quizQueue.length}`;
        document.getElementById('progress-fill').style.width = ((currentIdx+1)/quizQueue.length * 100) + '%';
        startCountdown(q);
        if(currentGameMode === 'choice') {
            document.getElementById('q-word-display').innerText = q.w;
            setupChoiceUI(q);
        } else {
            document.getElementById('q-word-display').innerText = q.m;
            setupInputUI(q);
        }
    }

    function startCountdown(q) {
        let timeLimit = parseInt(document.getElementById('quiz-time-input').value) || 0;
        if(timeLimit > 0) {
            let left = timeLimit;
            const timerEl = document.getElementById('timer-display');
            timerEl.innerText = left; timerEl.style.display = 'block';
            quizTimer = setInterval(() => {
                left--; timerEl.innerText = left;
                if(left <= 0) { clearInterval(quizTimer); handleWrong(q); }
            }, 1000);
        } else { document.getElementById('timer-display').style.display = 'none'; }
    }

    function setupChoiceUI(q) {
        document.getElementById('choice-next-box').style.display = 'none';
        let allM = [...new Set(db[currentDB].map(i => i.m))];
        let others = allM.filter(m => m !== q.m).sort(() => 0.5 - Math.random()).slice(0, 3);
        let opts = [...others, q.m].sort(() => 0.5 - Math.random());
        let html = '';
        opts.forEach(o => {
            html += `<button class="option-btn" onclick="checkChoiceAns(this, '${o.replace(/'/g, "\\'")}', '${q.m.replace(/'/g, "\\")}')">${o}</button>`;
        });
        document.getElementById('q-options-container').innerHTML = html;
    }

    function checkChoiceAns(btn, sel, cor) {
        if(quizTimer) clearInterval(quizTimer);
        let q = quizQueue[currentIdx];
        document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
        if(sel === cor) {
            btn.classList.add('correct'); updateStat(q, true);
            confetti({ particleCount: 40, spread: 50 }); correctCount++;
            setTimeout(nextQ, 800);
        } else { btn.classList.add('wrong'); handleWrong(q); }
    }

    function setupInputUI(q) {
        document.getElementById('wrong-confirm-box').style.display = 'none';
        document.getElementById('input-zone').style.display = 'block';
        const hintEl = document.getElementById('q-hint-display');
        if(document.getElementById('hint-toggle').checked) {
            let w = q.w.trim();
            hintEl.innerText = `${w[0]}_____ ${w[w.length-1]}`;
            hintEl.style.display = 'block';
        } else { hintEl.style.display = 'none'; }
        const inp = document.getElementById('ans-in');
        inp.value = ""; inp.focus();
        inp.onkeydown = (e) => { if(e.key === 'Enter') checkInputAns(); };
    }

    function checkInputAns() {
        if(quizTimer) clearInterval(quizTimer);
        let q = quizQueue[currentIdx];
        let user = document.getElementById('ans-in').value.trim().toLowerCase();
        if(user === q.w.toLowerCase()) {
            updateStat(q, true); confetti({ particleCount: 40, spread: 50 });
            correctCount++; nextQ();
        } else { handleWrong(q); }
    }

    function handleWrong(q) {
        updateStat(q, false); wrongList.push(q);
        if(currentGameMode === 'choice') {
            document.querySelectorAll('.option-btn').forEach(b => {
                if(b.innerText === q.m) b.classList.add('correct');
                b.disabled = true;
            });
            document.getElementById('choice-next-box').style.display = 'block';
        } else {
            document.getElementById('input-zone').style.display = 'none';
            document.getElementById('wrong-msg').innerHTML = `âŒ æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<br><b style="font-size:24px;">${q.w}</b>`;
            document.getElementById('wrong-confirm-box').style.display = 'block';
        }
    }

    function updateStat(item, isCorrect) {
        if (!item.stats) item.stats = { choice: {t:0, c:0}, input: {t:0, c:0} };
        item.stats[currentGameMode].t++;
        if (isCorrect) item.stats[currentGameMode].c++;
        saveDB();
    }

    function nextQ() {
        currentIdx++;
        if(currentIdx < quizQueue.length) renderNextQ();
        else showResult();
    }

    function showResult() {
        document.getElementById('res-total').innerText = quizQueue.length;
        document.getElementById('res-correct').innerText = correctCount;
        document.getElementById('res-rate').innerText = Math.round((correctCount / quizQueue.length) * 100) + "%";
        if(wrongList.length > 0) {
            document.getElementById('res-wrong-section').style.display = 'block';
            document.getElementById('res-wrong-list').innerText = [...new Set(wrongList.map(i => `${i.w} ${i.m}`))].join('\n');
        } else { document.getElementById('res-wrong-section').style.display = 'none'; }
        go('p-result');
    }

    function copyWrongList() {
        navigator.clipboard.writeText(document.getElementById('res-wrong-list').innerText).then(() => alert("å·²è¤‡è£½ï¼"));
    }

    window.onload = () => { if(Object.keys(db).length > 0) drawDBList(); };
</script>
</body>
</html>
